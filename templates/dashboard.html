{% extends 'base.html' %}

{% block title %}Dashboard{% endblock %}
{% block page_title %}Panel de Control{% endblock %}

{% block content %}
<div class="container-fluid">
  <div class="row mb-4">
    <div class="col-md-12">
      <h2 class="text-primary">¡Bienvenido al Sistema de Inventario de Activos!</h2>
      <p class="text-muted">Visualizá aquí el estado general de los activos registrados.</p>
    </div>
  </div>

  <!-- Tarjetas de resumen -->
  <div class="row">
    <div class="col-md-3 mb-4">
      <div class="card border-start border-primary border-4 shadow h-100 py-2">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <h6 class="text-primary fw-bold">Total de Activos</h6>
            <h3 class="fw-semibold">{{ total_activos|default:0 }}</h3>
          </div>
          <div class="text-primary">
            <i class="bi bi-hdd-stack-fill" style="font-size: 2.5rem;"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-4">
      <div class="card border-start border-success border-4 shadow h-100 py-2">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <h6 class="text-success fw-bold">Activos Activos</h6>
            <h3>{{ activos_activos|default:0 }}</h3>
          </div>
          <div class="text-success">
            <i class="bi bi-check-circle-fill" style="font-size: 2.5rem;"></i>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-3 mb-4">
      <div class="card border-start border-warning border-4 shadow h-100 py-2">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <h6 class="text-warning fw-bold">En Observación</h6>
            <h3>{{ activos_observacion|default:0 }}</h3>
          </div>
          <div class="text-warning">
            <i class="bi bi-exclamation-triangle-fill" style="font-size: 2.5rem;"></i>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-4">
      <div class="card border-start border-danger border-4 shadow h-100 py-2">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <h6 class="text-danger fw-bold">Quemado</h6>
            <h3>{{ activos_quemados|default:0 }}</h3>
          </div>
          <div class="text-danger">
            <i class="bi bi-x-octagon-fill" style="font-size: 2.5rem;"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

    <div class="col-md-3 mb-4">
      <div class="card border-start border-black border-4 shadow h-100 py-2">
        <div class="card-body d-flex align-items-center justify-content-between">
          <div>
            <h6 class="text-black fw-bold">Dado de Baja</h6>
            <h3>{{ activos_baja|default:0 }}</h3>
          </div>
          <div class="text-black">
            <i class="bi bi-x-octagon-fill" style="font-size: 2.5rem;"></i>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gráfico -->
  <div class="row">
    <div class="col-md-12">
      <div class="card shadow mb-4">
        <div class="card-header bg-primary text-white">
          Distribución de Estados de los Activos
        </div>
        <div class="card-body">
          <canvas id="estadoChart" height="120"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  (function() {
    const el = document.getElementById('estadoChart');
    if (!el) return;

    const ctx = el.getContext('2d');
    new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Activo', 'En Observación', 'Quemado', 'Dado de Baja'],
        datasets: [{
          label: 'Cantidad',
         data: [
                {{ activos_activos|default_if_none:0|default:0|floatformat:"0" }},
                {{ activos_observacion|default_if_none:0|default:0|floatformat:"0" }},
                {{ activos_quemados|default_if_none:0|default:0|floatformat:"0" }},
                {{ activos_baja|default_if_none:0|default:0|floatformat:"0" }}
                ],

                backgroundColor: [
                    'rgba(40, 167, 69, 0.7)',
                    'rgba(255, 193, 7, 0.7)',
                    'rgba(220, 53, 69, 0.7)',
                    'rgba(108, 117, 125, 0.7)'
                ],
                borderColor: [
                    'rgba(40, 167, 69, 1)',
                    'rgba(255, 193, 7, 1)',
                    'rgba(220, 53, 69, 1)',
                    'rgba(108, 117, 125, 1)'
                ],
                borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                plugins: { legend: { position: 'bottom' } }
            }
            });
        })();
</script>
{% endblock %}
